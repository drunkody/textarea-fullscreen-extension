# –°–ª–∞–π–¥ 10: –í—Å–ø–ª—ã–≤–∞—é—â–µ–µ –æ–∫–Ω–æ –Ω–∞—Å—Ç—Ä–æ–µ–∫ (Settings Popup UI)

**–í–µ—Ç–∫–∞:** `react/10-settings-popup`

---

## üéØ –ß—Ç–æ —Ç–∞–∫–æ–µ –≤—Å–ø–ª—ã–≤–∞—é—â–µ–µ –æ–∫–Ω–æ –Ω–∞—Å—Ç—Ä–æ–µ–∫?

–ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å –Ω–∞—Å—Ç—Ä–æ–µ–∫, –∫–æ—Ç–æ—Ä—ã–π –ø–æ—è–≤–ª—è–µ—Ç—Å—è –ø—Ä–∏ –∫–ª–∏–∫–µ –Ω–∞ –∏–∫–æ–Ω–∫—É —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è –≤ –ø–∞–Ω–µ–ª–∏ –±—Ä–∞—É–∑–µ—Ä–∞. –ü–æ—Å—Ç—Ä–æ–µ–Ω —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º React –∏ react-hook-form, –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç —É–¥–æ–±–Ω—ã–π —Å–ø–æ—Å–æ–± –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–æ–≤–µ–¥–µ–Ω–∏—è —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è, –≥–æ—Ä—è—á–∏—Ö –∫–ª–∞–≤–∏—à –∏ –∏—Å–∫–ª—é—á—ë–Ω–Ω—ã—Ö –¥–æ–º–µ–Ω–æ–≤.

–ö–ª—é—á–µ–≤—ã–µ –º–æ–º–µ–Ω—Ç—ã:
- ‚ö° **Popup Entrypoint** - –û—Ç–¥–µ–ª—å–Ω–∞—è HTML-—Å—Ç—Ä–∞–Ω–∏—Ü–∞ –¥–ª—è UI –Ω–∞—Å—Ç—Ä–æ–µ–∫
- üé® **React Hook Form** - –≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ñ–æ—Ä–º–∞–º–∏ —Å –≤–∞–ª–∏–¥–∞—Ü–∏–µ–π
- üì¶ **Browser Storage** - –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ/–∑–∞–≥—Ä—É–∑–∫–∞ –Ω–∞—Å—Ç—Ä–æ–µ–∫ —á–µ—Ä–µ–∑ browser.storage API
- üîÑ **–û–±–Ω–æ–≤–ª–µ–Ω–∏—è –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏** - –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—Ä–∏–º–µ–Ω—è—é—Ç—Å—è –Ω–∞ –≤—Å–µ—Ö –≤–∫–ª–∞–¥–∫–∞—Ö
- üõ†Ô∏è **–í–∞–ª–∏–¥–∞—Ü–∏—è —Ñ–æ—Ä–º** - –ö–ª–∏–µ–Ω—Ç—Å–∫–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è —Å —Å–æ–æ–±—â–µ–Ω–∏—è–º–∏ –æ–± –æ—à–∏–±–∫–∞—Ö

---

## üìÇ –§–∞–π–ª—ã –¥–ª—è –∏–∑—É—á–µ–Ω–∏—è

<details>
<summary><b>–ù–æ–≤—ã–µ/–ò–∑–º–µ–Ω—ë–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã</b></summary>

- üìÑ [entrypoints/popup/App.tsx](../textarea-fullscreen-react/entrypoints/popup/App.tsx)
- üìÑ [entrypoints/popup/App.css](../textarea-fullscreen-react/entrypoints/popup/App.css)
- üìÑ [entrypoints/popup/index.html](../textarea-fullscreen-react/entrypoints/popup/index.html)
- üìÑ [entrypoints/popup/main.tsx](../textarea-fullscreen-react/entrypoints/popup/main.tsx)
- üìÑ [entrypoints/popup/style.css](../textarea-fullscreen-react/entrypoints/popup/style.css)
- üìÑ [components/SettingsForm/index.tsx](../textarea-fullscreen-react/components/SettingsForm/index.tsx)
- üìÑ [components/SettingsForm/style.css](../textarea-fullscreen-react/components/SettingsForm/style.css)

</details>

<details>
<summary><b>–í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ–∞–π–ª—ã</b></summary>

- üìÑ [types/settings.ts](../textarea-fullscreen-react/types/settings.ts) - **–ù–û–í–´–ô**
- üìÑ [hooks/useSettings.ts](../textarea-fullscreen-react/hooks/useSettings.ts) - **–ù–û–í–´–ô**
- üìÑ [utils/constants.ts](../textarea-fullscreen-react/utils/constants.ts)
- üìÑ [wxt.config.ts](../textarea-fullscreen-react/wxt.config.ts)
- üìÑ [package.json](../textarea-fullscreen-react/package.json)

</details>

---

## ‚úÖ –ß—Ç–æ –Ω–æ–≤–æ–≥–æ –≤ —ç—Ç–æ–º —Å–ª–∞–π–¥–µ

- ‚úÖ –°–æ–∑–¥–∞–Ω popup entrypoint —Å HTML-—Å—Ç—Ä–∞–Ω–∏—Ü–µ–π
- ‚úÖ –ü–æ—Å—Ç—Ä–æ–µ–Ω–∞ —Ñ–æ—Ä–º–∞ –Ω–∞—Å—Ç—Ä–æ–µ–∫ —Å react-hook-form
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∞ –≤–∞–ª–∏–¥–∞—Ü–∏—è —Ñ–æ—Ä–º (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è, –º–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –¥–ª–∏–Ω–∞)
- ‚úÖ –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω browser.storage –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö
- ‚úÖ –°–æ–∑–¥–∞–Ω –∫–æ–º–ø–æ–Ω–µ–Ω—Ç SettingsForm
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω—ã —Å–æ–æ–±—â–µ–Ω–∏—è –æ–± —É—Å–ø–µ—Ö–µ/–æ—à–∏–±–∫–µ
- ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –Ω–∞—Å—Ç—Ä–æ–µ–∫ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
- ‚úÖ **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω—ã –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –∏–º–ø–æ—Ä—Ç—ã** (useSettings, browser API)
- ‚úÖ **–î–æ–±–∞–≤–ª–µ–Ω—ã —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è –≤ manifest** (storage, tabs)

---

## üêõ –í–∞–∂–Ω—ã–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

<details>
<summary><b>‚ö†Ô∏è –†–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω—ë–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã –∏ —Ä–µ—à–µ–Ω–∏—è</b></summary>

### –ü—Ä–æ–±–ª–µ–º–∞ 1: Popup –Ω–µ –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è (–±–µ—Å–∫–æ–Ω–µ—á–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞)

**–°–∏–º–ø—Ç–æ–º—ã:**
- –ü—Ä–∏ –∫–ª–∏–∫–µ –Ω–∞ –∏–∫–æ–Ω–∫—É —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è popup –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç "Loading..." –≤–µ—á–Ω–æ
- –í –∫–æ–Ω—Å–æ–ª–∏ –æ—à–∏–±–∫–∞: `browser is not defined`

**–†–µ—à–µ–Ω–∏–µ:**
–î–æ–±–∞–≤–∏—Ç—å –∏–º–ø–æ—Ä—Ç –≤ `hooks/useSettings.ts`:

```typescript
import browser from 'webextension-polyfill';
```

---

### –ü—Ä–æ–±–ª–µ–º–∞ 2: –û—à–∏–±–∫–∏ –∏–º–ø–æ—Ä—Ç–∞ –≤ ContentApp

**–°–∏–º–ø—Ç–æ–º—ã:**
- `useTextareaDetector is not defined`
- `useButtonContainers is not defined`

**–†–µ—à–µ–Ω–∏–µ:**
–î–æ–±–∞–≤–∏—Ç—å –∏–º–ø–æ—Ä—Ç—ã –≤ `entrypoints/content/ContentApp.tsx`:

```typescript
import { useTextareaDetector } from '../../hooks/useTextareaDetector';
import { useButtonContainers } from '../../hooks/useButtonContainers';
```

---

### –ü—Ä–æ–±–ª–µ–º–∞ 3: Logger –Ω–µ –æ–ø—Ä–µ–¥–µ–ª—ë–Ω

**–°–∏–º–ø—Ç–æ–º—ã:**
- `logger is not defined` –≤ content script

**–†–µ—à–µ–Ω–∏–µ:**
–î–æ–±–∞–≤–∏—Ç—å –∏–º–ø–æ—Ä—Ç –≤ `entrypoints/content/index.tsx`:

```typescript
import { logger } from '../../utils/logger';
```

---

### –ü—Ä–æ–±–ª–µ–º–∞ 4: Storage permissions

**–°–∏–º–ø—Ç–æ–º—ã:**
- `storage.sync is undefined`
- –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –Ω–µ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è

**–†–µ—à–µ–Ω–∏–µ:**
–û–±–Ω–æ–≤–∏—Ç—å `wxt.config.ts`:

```typescript
export default defineConfig({
  modules: ['@wxt-dev/module-react'],
  manifest: {
    permissions: ['storage', 'tabs']
  }
});
```

</details>

---

**–°–ª–µ–¥—É—é—â–∏–π:** [–°–ª–∞–π–¥ 11: –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Ö—Ä–∞–Ω–∏–ª–∏—â–∞](./11-storage-api.md)

---

## üìë –ü–æ–¥—Ä–æ–±–Ω–æ–µ –∏–∑—É—á–µ–Ω–∏–µ

- [–ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç](#–∫–∞–∫-—ç—Ç–æ-—Ä–∞–±–æ—Ç–∞–µ—Ç)
- [–®–∞–≥–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏](#—à–∞–≥–∏-—Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏)
- [–ö–ª—é—á–µ–≤—ã–µ –∫–æ–Ω—Ü–µ–ø—Ü–∏–∏](#–∫–ª—é—á–µ–≤—ã–µ-–∫–æ–Ω—Ü–µ–ø—Ü–∏–∏)
- [–ü—Ä–∏–º–µ—Ä—ã –∫–æ–¥–∞](#–ø—Ä–∏–º–µ—Ä—ã-–∫–æ–¥–∞)
- [–†–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω—ë–Ω–Ω—ã–µ –ø–∞—Ç—Ç–µ—Ä–Ω—ã](#—Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω—ë–Ω–Ω—ã–µ-–ø–∞—Ç—Ç–µ—Ä–Ω—ã)
- [–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è](#–¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è)
- [–ó–∞–¥–∞–Ω–∏–µ](#–∑–∞–¥–∞–Ω–∏–µ)

---

## –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç

```mermaid
graph TB
    A[–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∫–ª–∏–∫–∞–µ—Ç –Ω–∞ –∏–∫–æ–Ω–∫—É —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è] --> B[–ë—Ä–∞—É–∑–µ—Ä –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç popup.html]
    B --> C[React —Ä–µ–Ω–¥–µ—Ä–∏—Ç PopupApp]
    C --> D[–ó–∞–≥—Ä—É–∂–∞–µ—Ç –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∏–∑ storage]
    D --> E[–û—Ç–æ–±—Ä–∞–∂–∞–µ—Ç –≤ —Ñ–æ—Ä–º–µ]
    E --> F{–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∏–∑–º–µ–Ω—è–µ—Ç –Ω–∞—Å—Ç—Ä–æ–π–∫–∏}
    F --> G[–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∫–ª–∏–∫–∞–µ—Ç Save]
    G --> H[–í–∞–ª–∏–¥–∞—Ü–∏—è —Ñ–æ—Ä–º—ã]
    H --> I{–í–∞–ª–∏–¥–Ω–∞?}
    I -->|–ù–µ—Ç| J[–ü–æ–∫–∞–∑–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö]
    I -->|–î–∞| K[–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤ browser.storage]
    K --> L[–£–≤–µ–¥–æ–º–∏—Ç—å –≤—Å–µ –≤–∫–ª–∞–¥–∫–∏]
    L --> M[–ü–æ–∫–∞–∑–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± —É—Å–ø–µ—Ö–µ]
    
    style C fill:#61dafb
    style K fill:#54bc4a
    style M fill:#ffa500
```

**–û–±—ä—è—Å–Ω–µ–Ω–∏–µ –ø–æ—Ç–æ–∫–∞:**
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∫–ª–∏–∫–∞–µ—Ç –Ω–∞ –∏–∫–æ–Ω–∫—É —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è ‚Üí –ë—Ä–∞—É–∑–µ—Ä –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç popup
2. Popup –∑–∞–≥—Ä—É–∂–∞–µ—Ç —Ç–µ–∫—É—â–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∏–∑ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞
3. –§–æ—Ä–º–∞ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è —Å —Ç–µ–∫—É—â–∏–º–∏ –∑–Ω–∞—á–µ–Ω–∏—è–º–∏
4. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–Ω–æ—Å–∏—Ç –∏–∑–º–µ–Ω–µ–Ω–∏—è
5. –ü—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ —Ñ–æ—Ä–º–∞ –≤–∞–ª–∏–¥–∏—Ä—É–µ—Ç –¥–∞–Ω–Ω—ã–µ
6. –í–∞–ª–∏–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ browser.storage
7. –í—Å–µ content scripts –ø–æ–ª—É—á–∞—é—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ–± –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏
8. –û—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± —É—Å–ø–µ—Ö–µ

---

## –®–∞–≥–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

### 1. –û–±–Ω–æ–≤–∏—Ç—å Manifest –¥–ª—è Popup

```typescript
// wxt.config.ts
import { defineConfig } from 'wxt';

export default defineConfig({
  modules: ['@wxt-dev/module-react'],
  manifest: {
    name: 'Textarea Fullscreen',
    description: 'Fullscreen editor for any textarea',
    version: '1.0.0',
    permissions: ['storage', 'tabs'],
    action: {
      default_popup: 'popup.html',
      default_title: 'Textarea Fullscreen Settings'
    }
  }
});
```

**–ß—Ç–æ —ç—Ç–æ –¥–µ–ª–∞–µ—Ç:**
- `action.default_popup` - –û—Ç–∫—Ä—ã–≤–∞–µ—Ç popup.html –ø—Ä–∏ –∫–ª–∏–∫–µ –Ω–∞ –∏–∫–æ–Ω–∫—É
- `permissions: ["storage", "tabs"]` - –†–∞–∑—Ä–µ—à–∞–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ browser.storage –∏ tabs API

---

### 2. –°–æ–∑–¥–∞—Ç—å HTML entrypoint –¥–ª—è Popup

```html
<!-- entrypoints/popup/index.html -->
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Textarea Fullscreen - Settings</title>
    <meta name="manifest.type" content="browser_action" />
  </head>
  <body>
    <div id="root"></div>
    <script type="module" src="./main.tsx"></script>
  </body>
</html>
```

**–°—Ç—Ä—É–∫—Ç—É—Ä–∞:**
- –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π HTML-—Å–∫–µ–ª–µ—Ç
- Root div –¥–ª—è React
- Module script –∑–∞–≥—Ä—É–∂–∞–µ—Ç React-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ

---

### 3. –°–æ–∑–¥–∞—Ç—å React —Ç–æ—á–∫—É –≤—Ö–æ–¥–∞

```tsx
// entrypoints/popup/main.tsx
import React from 'react';
import ReactDOM from 'react-dom/client';
import App from './App.tsx';
import './style.css';

ReactDOM.createRoot(document.getElementById('root')!).render(
  <React.StrictMode>
    <App />
  </React.StrictMode>,
);
```

---

### 4. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

```bash
npm install react-hook-form webextension-polyfill
npm install -D @types/webextension-polyfill
```

**–ó–∞—á–µ–º react-hook-form?**
- –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ —Ä–µ-—Ä–µ–Ω–¥–µ—Ä—ã (–ª—É—á—à–∞—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å)
- –í—Å—Ç—Ä–æ–µ–Ω–Ω–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è
- –ü—Ä–æ—Å—Ç–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º —Ñ–æ—Ä–º—ã
- –ú–∞–ª—ã–π —Ä–∞–∑–º–µ—Ä –±–∞–Ω–¥–ª–∞

**–ó–∞—á–µ–º webextension-polyfill?**
- –ö—Ä–æ—Å—Å–±—Ä–∞—É–∑–µ—Ä–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å (Chrome/Firefox)
- Promise-based API (–≤–º–µ—Å—Ç–æ callbacks)
- TypeScript —Ç–∏–ø—ã –∏–∑ –∫–æ—Ä–æ–±–∫–∏

---

### 5. –°–æ–∑–¥–∞—Ç—å –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –Ω–∞—Å—Ç—Ä–æ–µ–∫

```typescript
// types/settings.ts
export interface Settings {
  enabled: boolean;
  overlay: boolean;
  shortcutKey: string;
  excludedDomains: string;
}

export const DEFAULT_SETTINGS: Settings = {
  enabled: true,
  overlay: true,
  shortcutKey: 'f',
  excludedDomains: ''
};
```

---

### 6. –°–æ–∑–¥–∞—Ç—å —Ö—É–∫ –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏

```typescript
// hooks/useSettings.ts
import { useState, useEffect, useCallback } from 'react';
import browser from 'webextension-polyfill'; // ‚ö†Ô∏è –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ô –ò–ú–ü–û–†–¢
import { DEFAULT_SETTINGS, type Settings } from '../types/settings';
import { logger } from '../utils/logger';

export function useSettings() {
  const [settings, setSettings] = useState<Settings>(DEFAULT_SETTINGS);
  const [loading, setLoading] = useState(true);
  const [error, setError] = useState<string | null>(null);

  // –ó–∞–≥—Ä—É–∑–∫–∞ –Ω–∞—Å—Ç—Ä–æ–µ–∫ –ø—Ä–∏ –º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏
  useEffect(() => {
    logger.info('[useSettings] Loading settings from storage...');
    
    browser.storage.sync
      .get(DEFAULT_SETTINGS)
      .then((data) => {
        const loadedSettings = data as Settings;
        logger.success('[useSettings] Settings loaded', loadedSettings);
        setSettings(loadedSettings);
        setLoading(false);
      })
      .catch((err) => {
        logger.error('[useSettings] Failed to load settings', err);
        setError('Failed to load settings');
        setLoading(false);
      });
  }, []);

  // –°–ª—É—à–∞—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ storage
  useEffect(() => {
    const handleStorageChange = (
      changes: Record<string, browser.Storage.StorageChange>,
      areaName: string
    ) => {
      if (areaName !== 'sync') return;

      logger.info('[useSettings] Storage changed', changes);

      setSettings((prev) => {
        const updated = { ...prev };
        let hasChanges = false;

        for (const key in changes) {
          if (key in DEFAULT_SETTINGS) {
            updated[key as keyof Settings] = changes[key].newValue;
            hasChanges = true;
          }
        }

        return hasChanges ? updated : prev;
      });
    };

    browser.storage.onChanged.addListener(handleStorageChange);

    return () => {
      browser.storage.onChanged.removeListener(handleStorageChange);
    };
  }, []);

  // –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
  const saveSettings = useCallback(async (newSettings: Settings) => {
    logger.info('[useSettings] Saving settings...', newSettings);

    try {
      await browser.storage.sync.set(newSettings);
      setSettings(newSettings);
      logger.success('[useSettings] Settings saved successfully');

      // –£–≤–µ–¥–æ–º–∏—Ç—å –≤—Å–µ –≤–∫–ª–∞–¥–∫–∏
      const tabs = await browser.tabs.query({});
      const message = { type: 'SETTINGS_UPDATED', settings: newSettings };

      tabs.forEach((tab) => {
        if (tab.id) {
          browser.tabs
            .sendMessage(tab.id, message)
            .catch(() => {}); // –ò–≥–Ω–æ—Ä–∏—Ä—É–µ–º –æ—à–∏–±–∫–∏
        }
      });
    } catch (err) {
      logger.error('[useSettings] Failed to save settings', err);
      throw new Error('Failed to save settings');
    }
  }, []);

  return {
    settings,
    loading,
    error,
    saveSettings
  };
}
```

**‚ö†Ô∏è –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏ –≤–∞–∂–Ω–æ:**
- –ò–º–ø–æ—Ä—Ç `browser from 'webextension-polyfill'` - –ë–ï–ó –ù–ï–ì–û POPUP –ù–ï –†–ê–ë–û–¢–ê–ï–¢
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `browser.storage.sync` –¥–ª—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –º–µ–∂–¥—É —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞–º–∏
- –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ/—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏

---

### 7. –°–æ–∑–¥–∞—Ç—å –∫–æ–º–ø–æ–Ω–µ–Ω—Ç —Ñ–æ—Ä–º—ã –Ω–∞—Å—Ç—Ä–æ–µ–∫

```tsx
// components/SettingsForm/index.tsx
import { useForm } from 'react-hook-form';
import type { Settings } from '../../types/settings';
import './style.css';

interface SettingsFormProps {
  settings: Settings;
  onSave: (data: Settings) => void;
}

export function SettingsForm({ settings, onSave }: SettingsFormProps) {
  const { 
    register, 
    handleSubmit, 
    formState: { errors, isSubmitting } 
  } = useForm<Settings>({
    defaultValues: settings
  });

  return (
    <form onSubmit={handleSubmit(onSave)} className="settings-form">
      {/* –í–∫–ª—é—á–∏—Ç—å —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ */}
      <div className="form-group">
        <label className="checkbox-label">
          <input type="checkbox" {...register('enabled')} />
          <span>–í–∫–ª—é—á–∏—Ç—å —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ</span>
        </label>
        <small className="form-hint">
          –í–∫–ª—é—á–∏—Ç—å/–≤—ã–∫–ª—é—á–∏—Ç—å –≤—Å—ë —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ
        </small>
      </div>

      {/* –ü–æ–∫–∞–∑—ã–≤–∞—Ç—å overlay */}
      <div className="form-group">
        <label className="checkbox-label">
          <input type="checkbox" {...register('overlay')} />
          <span>–ü–æ–∫–∞–∑—ã–≤–∞—Ç—å –∑–∞—Ç–µ–º–Ω—ë–Ω–Ω—ã–π —Ñ–æ–Ω</span>
        </label>
        <small className="form-hint">
          –ó–∞—Ç–µ–º–Ω—è—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ –ø–æ–ª–Ω–æ—ç–∫—Ä–∞–Ω–Ω–æ–≥–æ —Ä–µ–¥–∞–∫—Ç–æ—Ä–∞
        </small>
      </div>

      {/* –ì–æ—Ä—è—á–∞—è –∫–ª–∞–≤–∏—à–∞ */}
      <div className="form-group">
        <label htmlFor="shortcutKey" className="form-label">
          –ì–æ—Ä—è—á–∞—è –∫–ª–∞–≤–∏—à–∞
        </label>
        <input
          id="shortcutKey"
          type="text"
          maxLength={1}
          placeholder="f"
          className="form-input"
          {...register('shortcutKey', { 
            required: '–ì–æ—Ä—è—á–∞—è –∫–ª–∞–≤–∏—à–∞ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–∞',
            maxLength: {
              value: 1,
              message: '–†–∞–∑—Ä–µ—à—ë–Ω —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω —Å–∏–º–≤–æ–ª'
            },
            pattern: {
              value: /^[a-z0-9]$/i,
              message: '–î–æ–ª–∂–Ω–∞ –±—ã—Ç—å –±—É–∫–≤–∞ –∏–ª–∏ —Ü–∏—Ñ—Ä–∞'
            }
          })}
        />
        <small className="form-hint">
          –ù–∞–∂–º–∏—Ç–µ Ctrl+[–ö–ª–∞–≤–∏—à–∞] –¥–ª—è –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è –ø–æ–ª–Ω–æ—ç–∫—Ä–∞–Ω–Ω–æ–≥–æ —Ä–µ–∂–∏–º–∞
        </small>
        {errors.shortcutKey && (
          <span className="error-message">{errors.shortcutKey.message}</span>
        )}
      </div>

      {/* –ò—Å–∫–ª—é—á—ë–Ω–Ω—ã–µ –¥–æ–º–µ–Ω—ã */}
      <div className="form-group">
        <label htmlFor="excludedDomains" className="form-label">
          –ò—Å–∫–ª—é—á—ë–Ω–Ω—ã–µ –¥–æ–º–µ–Ω—ã
        </label>
        <textarea
          id="excludedDomains"
          rows={4}
          placeholder="mail.google.com&#10;docs.google.com&#10;github.com"
          className="form-textarea"
          {...register('excludedDomains')}
        />
        <small className="form-hint">
          –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ –Ω–µ –±—É–¥–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –Ω–∞ —ç—Ç–∏—Ö –¥–æ–º–µ–Ω–∞—Ö (–æ–¥–∏–Ω –Ω–∞ —Å—Ç—Ä–æ–∫—É)
        </small>
      </div>

      {/* –ö–Ω–æ–ø–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ */}
      <button type="submit" className="submit-button" disabled={isSubmitting}>
        {isSubmitting ? '–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ...' : '–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏'}
      </button>
    </form>
  );
}
```

**–ö–ª—é—á–µ–≤—ã–µ —á–∞—Å—Ç–∏:**
- `register()` - –°–≤—è–∑—ã–≤–∞–µ—Ç inputs —Å —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º —Ñ–æ—Ä–º—ã
- `handleSubmit()` - –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –æ—Ç–ø—Ä–∞–≤–∫—É —Å –≤–∞–ª–∏–¥–∞—Ü–∏–µ–π
- `errors` - –°–æ–¥–µ—Ä–∂–∏—Ç –æ—à–∏–±–∫–∏ –≤–∞–ª–∏–¥–∞—Ü–∏–∏
- –ü—Ä–∞–≤–∏–ª–∞ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –≤—Å—Ç—Ä–æ–µ–Ω—ã –≤ register

---

### 8. –°–æ–∑–¥–∞—Ç—å –≥–ª–∞–≤–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ Popup

```tsx
// entrypoints/popup/App.tsx
import { useState } from 'react';
import { SettingsForm } from '../../components/SettingsForm';
import { useSettings } from '../../hooks/useSettings';
import type { Settings } from '../../types/settings';
import './App.css';

export default function App() {
  const { settings, loading, saveSettings } = useSettings();
  const [statusMessage, setStatusMessage] = useState('');
  const [statusType, setStatusType] = useState<'success' | 'error'>('success');

  const handleSave = async (newSettings: Settings) => {
    try {
      await saveSettings(newSettings);
      setStatusType('success');
      setStatusMessage('‚úì –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —É—Å–ø–µ—à–Ω–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã!');
      
      // –û—á–∏—Å—Ç–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ —á–µ—Ä–µ–∑ 2 —Å–µ–∫—É–Ω–¥—ã
      setTimeout(() => setStatusMessage(''), 2000);
    } catch (error) {
      setStatusType('error');
      setStatusMessage('‚úó –ù–µ —É–¥–∞–ª–æ—Å—å —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏');
      
      setTimeout(() => setStatusMessage(''), 3000);
    }
  };

  if (loading) {
    return (
      <div className="popup-container">
        <div className="loading">
          <div className="spinner"></div>
          <p>–ó–∞–≥—Ä—É–∑–∫–∞ –Ω–∞—Å—Ç—Ä–æ–µ–∫...</p>
        </div>
      </div>
    );
  }

  return (
    <div className="popup-container">
      {/* –ó–∞–≥–æ–ª–æ–≤–æ–∫ */}
      <div className="popup-header">
        <h3 className="popup-title">
          <span className="popup-icon">‚õ∂</span>
          Textarea Fullscreen
        </h3>
        <p className="popup-subtitle">–ù–∞—Å—Ç—Ä–æ–π—Ç–µ –ø–æ–ª–Ω–æ—ç–∫—Ä–∞–Ω–Ω—ã–π —Ä–µ–∂–∏–º</p>
      </div>

      {/* –°—Ç–∞—Ç—É—Å–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ */}
      {statusMessage && (
        <div className={`status-message status-${statusType}`}>
          {statusMessage}
        </div>
      )}

      {/* –§–æ—Ä–º–∞ –Ω–∞—Å—Ç—Ä–æ–µ–∫ */}
      <SettingsForm settings={settings} onSave={handleSave} />

      {/* –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω—ã–π –±–ª–æ–∫ */}
      <div className="info-box">
        <strong>üí° –ü–æ–¥—Å–∫–∞–∑–∫–∞:</strong>
        <p>
          –ù–∞–∂–º–∏—Ç–µ <kbd>Ctrl</kbd>+<kbd>{settings.shortcutKey.toUpperCase()}</kbd> –Ω–∞
          –ª—é–±–æ–º textarea –¥–ª—è –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è –ø–æ–ª–Ω–æ—ç–∫—Ä–∞–Ω–Ω–æ–≥–æ —Ä–µ–∂–∏–º–∞.
        </p>
      </div>

      {/* –§—É—Ç–µ—Ä */}
      <div className="popup-footer">
        <small>–í–µ—Ä—Å–∏—è 1.0.0 ‚Ä¢ –°–¥–µ–ª–∞–Ω–æ —Å ‚ù§Ô∏è</small>
      </div>
    </div>
  );
}
```

---

### 9. –î–æ–±–∞–≤–∏—Ç—å —Å—Ç–∏–ª–∏

```css
/* entrypoints/popup/style.css */
* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

body {
  margin: 0;
  min-width: 380px;
  overflow-x: hidden;
}
```

```css
/* entrypoints/popup/App.css */
.popup-container {
  width: 380px;
  min-height: 400px;
  padding: 0;
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
  background: #f9fafb;
  color: #111827;
}

/* –ó–∞–≥–æ–ª–æ–≤–æ–∫ */
.popup-header {
  background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
  color: white;
  padding: 20px;
  text-align: center;
}

.popup-title {
  margin: 0;
  font-size: 20px;
  font-weight: 700;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 8px;
}

.popup-icon {
  font-size: 24px;
}

.popup-subtitle {
  margin: 8px 0 0 0;
  font-size: 13px;
  opacity: 0.9;
  font-weight: 400;
}

/* –°—Ç–∞—Ç—É—Å–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ */
.status-message {
  margin: 16px 16px 0;
  padding: 12px 16px;
  border-radius: 6px;
  font-size: 14px;
  font-weight: 500;
  text-align: center;
  animation: slideDown 0.3s ease;
}

@keyframes slideDown {
  from {
    opacity: 0;
    transform: translateY(-10px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

.status-success {
  background: #ecfdf5;
  color: #065f46;
  border: 1px solid #10b981;
}

.status-error {
  background: #fef2f2;
  color: #991b1b;
  border: 1px solid #ef4444;
}

/* –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä —Ñ–æ—Ä–º—ã */
.popup-container .settings-form {
  padding: 20px;
  background: white;
  margin: 16px;
  border-radius: 8px;
  box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
}

/* –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω—ã–π –±–ª–æ–∫ */
.info-box {
  margin: 0 16px 16px;
  padding: 12px;
  background: #fffbeb;
  border: 1px solid #fbbf24;
  border-left: 4px solid #f59e0b;
  border-radius: 6px;
  font-size: 13px;
  color: #92400e;
}

.info-box strong {
  display: block;
  margin-bottom: 4px;
  color: #78350f;
}

.info-box p {
  margin: 4px 0 0;
  line-height: 1.5;
}

.info-box kbd {
  display: inline-block;
  padding: 2px 6px;
  background: white;
  border: 1px solid #d97706;
  border-radius: 3px;
  font-family: 'Courier New', monospace;
  font-size: 12px;
  font-weight: 600;
  color: #92400e;
}

/* –§—É—Ç–µ—Ä */
.popup-footer {
  padding: 12px 20px;
  text-align: center;
  border-top: 1px solid #e5e7eb;
  background: white;
}

.popup-footer small {
  color: #6b7280;
  font-size: 12px;
}

/* –°–æ—Å—Ç–æ—è–Ω–∏–µ –∑–∞–≥—Ä—É–∑–∫–∏ */
.loading {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  padding: 60px 20px;
  gap: 16px;
}

.spinner {
  width: 40px;
  height: 40px;
  border: 4px solid #e5e7eb;
  border-top-color: #3b82f6;
  border-radius: 50%;
  animation: spin 0.8s linear infinite;
}

@keyframes spin {
  to {
    transform: rotate(360deg);
  }
}

.loading p {
  margin: 0;
  color: #6b7280;
  font-size: 14px;
}
```

```css
/* components/SettingsForm/style.css */
.settings-form {
  display: flex;
  flex-direction: column;
  gap: 20px;
}

/* –ì—Ä—É–ø–ø—ã —Ñ–æ—Ä–º—ã */
.form-group {
  display: flex;
  flex-direction: column;
  gap: 6px;
}

/* –ú–µ—Ç–∫–∏ */
.form-label {
  font-size: 14px;
  font-weight: 600;
  color: #1f2937;
}

.checkbox-label {
  display: flex;
  align-items: center;
  gap: 8px;
  font-size: 14px;
  font-weight: 500;
  color: #374151;
  cursor: pointer;
  user-select: none;
}

.checkbox-label input[type='checkbox'] {
  width: 16px;
  height: 16px;
  cursor: pointer;
}

.checkbox-label span {
  flex: 1;
}

/* –ü–æ–ª—è –≤–≤–æ–¥–∞ */
.form-input,
.form-textarea {
  padding: 10px 12px;
  border: 1px solid #d1d5db;
  border-radius: 6px;
  font-size: 14px;
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  transition: all 0.2s;
}

.form-input:focus,
.form-textarea:focus {
  outline: none;
  border-color: #3b82f6;
  box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
}

.form-input::placeholder,
.form-textarea::placeholder {
  color: #9ca3af;
}

.form-textarea {
  resize: vertical;
  min-height: 80px;
}

/* –ü–æ–¥—Å–∫–∞–∑–∫–∏ */
.form-hint {
  font-size: 12px;
  color: #6b7280;
  margin-top: -2px;
}

/* –°–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö */
.error-message {
  color: #ef4444;
  font-size: 12px;
  font-weight: 500;
  display: flex;
  align-items: center;
  gap: 4px;
}

.error-message::before {
  content: '‚ö†Ô∏è';
}

/* –ö–Ω–æ–ø–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ */
.submit-button {
  padding: 12px 16px;
  background: #3b82f6;
  color: white;
  border: none;
  border-radius: 6px;
  font-size: 14px;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.2s;
  box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
}

.submit-button:hover {
  background: #2563eb;
  box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
}

.submit-button:active {
  transform: translateY(1px);
}

.submit-button:disabled {
  background: #9ca3af;
  cursor: not-allowed;
  box-shadow: none;
}
```

---

## –ö–ª—é—á–µ–≤—ã–µ –∫–æ–Ω—Ü–µ–ø—Ü–∏–∏

### –ö–æ–Ω—Ü–µ–ø—Ü–∏—è 1: react-hook-form

```mermaid
graph LR
    A[–ü–æ–ª–µ –≤–≤–æ–¥–∞] --> B[register]
    B --> C[–°–æ—Å—Ç–æ—è–Ω–∏–µ —Ñ–æ—Ä–º—ã]
    C --> D[handleSubmit]
    D --> E[–í–∞–ª–∏–¥–∞—Ü–∏—è]
    E -->|–í–∞–ª–∏–¥–Ω–∞| F[onSubmit callback]
    E -->|–ù–µ–≤–∞–ª–∏–¥–Ω–∞| G[–æ–±—ä–µ–∫—Ç errors]
    
    style C fill:#61dafb
    style F fill:#54bc4a
    style G fill:#f44336
```

**–û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏:**

| –§—É–Ω–∫—Ü–∏—è | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ |
|---------|-----------|
| `register()` | –°–≤—è–∑–∞—Ç—å –ø–æ–ª–µ —Å —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º —Ñ–æ—Ä–º—ã |
| `handleSubmit()` | –û–±—Ä–∞–±–æ—Ç–∞—Ç—å –æ—Ç–ø—Ä–∞–≤–∫—É —Å –≤–∞–ª–∏–¥–∞—Ü–∏–µ–π |
| `formState.errors` | –î–æ—Å—Ç—É–ø –∫ –æ—à–∏–±–∫–∞–º –≤–∞–ª–∏–¥–∞—Ü–∏–∏ |
| `watch()` | –û—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å –∑–Ω–∞—á–µ–Ω–∏—è –ø–æ–ª–µ–π |
| `reset()` | –°–±—Ä–æ—Å–∏—Ç—å —Ñ–æ—Ä–º—É –∫ –∑–Ω–∞—á–µ–Ω–∏—è–º –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é |

**–ü—Ä–∏–º–µ—Ä:**
```tsx
const { register, handleSubmit, formState: { errors } } = useForm({
  defaultValues: { name: '–ò–≤–∞–Ω' }
});

// –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å –ø–æ–ª–µ
<input {...register('name', { required: true, maxLength: 20 })} />

// –ü–æ–∫–∞–∑–∞—Ç—å –æ—à–∏–±–∫–∏
{errors.name && <span>–≠—Ç–æ –ø–æ–ª–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ</span>}

// –û–±—Ä–∞–±–æ—Ç–∞—Ç—å –æ—Ç–ø—Ä–∞–≤–∫—É
<form onSubmit={handleSubmit(data => console.log(data))}>
```

---

### –ö–æ–Ω—Ü–µ–ø—Ü–∏—è 2: Browser Storage API

**–¢–∏–ø—ã —Ö—Ä–∞–Ω–∏–ª–∏—â:**

| –¢–∏–ø | –û–±–ª–∞—Å—Ç—å | –°–∏–Ω—Ö—Ä. | –õ–∏–º–∏—Ç —Ä–∞–∑–º–µ—Ä–∞ |
|-----|---------|--------|---------------|
| `storage.local` | –ù–∞ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–µ | ‚ùå –ù–µ—Ç | ~5MB |
| `storage.sync` | –ú–µ–∂–¥—É —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞–º–∏ | ‚úÖ –î–∞ | ~100KB |
| `storage.session` | –ù–∞ —Å–µ—Å—Å–∏—é | ‚ùå –ù–µ—Ç | ~1MB |

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:**
```typescript
import browser from 'webextension-polyfill';

// –°–æ—Ö—Ä–∞–Ω–∏—Ç—å
await browser.storage.sync.set({ key: 'value' });

// –ó–∞–≥—Ä—É–∑–∏—Ç—å
const data = await browser.storage.sync.get('key');
console.log(data.key); // 'value'

// –°–ª—É—à–∞—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è
browser.storage.onChanged.addListener((changes, area) => {
  if (area === 'sync' && changes.key) {
    console.log('–°—Ç–∞—Ä–æ–µ:', changes.key.oldValue);
    console.log('–ù–æ–≤–æ–µ:', changes.key.newValue);
  }
});
```

---

### –ö–æ–Ω—Ü–µ–ø—Ü–∏—è 3: –í–∞–ª–∏–¥–∞—Ü–∏—è —Ñ–æ—Ä–º

**–ü—Ä–∞–≤–∏–ª–∞ –≤–∞–ª–∏–¥–∞—Ü–∏–∏:**
```tsx
<input 
  {...register('email', {
    required: 'Email –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω',
    pattern: {
      value: /^[A-Z0-9._%+-]+@[A-Z0-9.-]+\.[A-Z]{2,}$/i,
      message: '–ù–µ–≤–µ—Ä–Ω—ã–π email –∞–¥—Ä–µ—Å'
    }
  })}
/>

<input
  {...register('age', {
    min: { value: 18, message: '–î–æ–ª–∂–Ω–æ –±—ã—Ç—å 18+' },
    max: { value: 120, message: '–ù–µ–≤–µ—Ä–Ω—ã–π –≤–æ–∑—Ä–∞—Å—Ç' },
    valueAsNumber: true
  })}
/>

<input
  {...register('username', {
    required: true,
    minLength: { value: 3, message: '–°–ª–∏—à–∫–æ–º –∫–æ—Ä–æ—Ç–∫–æ–µ' },
    maxLength: { value: 20, message: '–°–ª–∏—à–∫–æ–º –¥–ª–∏–Ω–Ω–æ–µ' },
    validate: {
      noSpaces: v => !/\s/.test(v) || '–ü—Ä–æ–±–µ–ª—ã –∑–∞–ø—Ä–µ—â–µ–Ω—ã',
      notTaken: async v => {
        const taken = await checkUsername(v);
        return !taken || '–ò–º—è –∑–∞–Ω—è—Ç–æ';
      }
    }
  })}
/>
```

---

### –ö–æ–Ω—Ü–µ–ø—Ü–∏—è 4: –°–≤—è–∑—å Popup –∏ Content Script

```mermaid
sequenceDiagram
    participant U as –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å
    participant P as Popup
    participant S as Storage
    participant C as Content Script
    
    U->>P: –ò–∑–º–µ–Ω—è–µ—Ç –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
    P->>S: –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤ storage
    S->>C: –°—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç onChanged
    C->>C: –ó–∞–≥—Ä—É–∑–∏—Ç—å –Ω–æ–≤—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
    C->>C: –ü—Ä–∏–º–µ–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è
```

**–ö–∞–∫ –æ–Ω–∏ –æ–±—â–∞—é—Ç—Å—è:**

1. **–ß–µ—Ä–µ–∑ Storage (–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è):**
   ```typescript
   // Popup —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç
   await browser.storage.sync.set({ enabled: false });
   
   // Content script —Å–ª—É—à–∞–µ—Ç
   browser.storage.onChanged.addListener((changes) => {
     if (changes.enabled) {
       applyNewSettings(changes.enabled.newValue);
     }
   });
   ```

2. **–ß–µ—Ä–µ–∑ —Å–æ–æ–±—â–µ–Ω–∏—è:**
   ```typescript
   // Popup –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ
   browser.tabs.sendMessage(tabId, { type: 'UPDATE_SETTINGS', data });
   
   // Content script –ø–æ–ª—É—á–∞–µ—Ç
   browser.runtime.onMessage.addListener((message) => {
     if (message.type === 'UPDATE_SETTINGS') {
       applySettings(message.data);
     }
   });
   ```

---

## –ü—Ä–∏–º–µ—Ä—ã –∫–æ–¥–∞

### –ü—Ä–∏–º–µ—Ä 1: –ü—Ä–æ—Å—Ç–∞—è —Ñ–æ—Ä–º–∞

```tsx
import { useForm } from 'react-hook-form';

export function SimpleSettings() {
  const { register, handleSubmit } = useForm({
    defaultValues: {
      enabled: true,
      theme: 'dark'
    }
  });

  const onSubmit = (data) => {
    console.log('–°–æ—Ö—Ä–∞–Ω—è—é:', data);
  };

  return (
    <form onSubmit={handleSubmit(onSubmit)}>
      <label>
        <input type="checkbox" {...register('enabled')} />
        –í–∫–ª—é—á–∏—Ç—å
      </label>
      
      <select {...register('theme')}>
        <option value="light">–°–≤–µ—Ç–ª–∞—è</option>
        <option value="dark">–¢—ë–º–Ω–∞—è</option>
      </select>
      
      <button type="submit">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
    </form>
  );
}
```

---

### –ü—Ä–∏–º–µ—Ä 2: –° –≤–∞–ª–∏–¥–∞—Ü–∏–µ–π

```tsx
export function ValidatedForm() {
  const { register, handleSubmit, formState: { errors } } = useForm();

  return (
    <form onSubmit={handleSubmit(data => console.log(data))}>
      <input
        {...register('name', {
          required: '–ò–º—è –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ',
          minLength: { value: 3, message: '–°–ª–∏—à–∫–æ–º –∫–æ—Ä–æ—Ç–∫–æ–µ' }
        })}
      />
      {errors.name && <span>{errors.name.message}</span>}
      
      <input
        type="number"
        {...register('age', {
          required: true,
          min: { value: 1, message: '–î–æ–ª–∂–Ω–æ –±—ã—Ç—å –ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω—ã–º' },
          max: { value: 120, message: '–ù–µ–≤–µ—Ä–Ω–æ' }
        })}
      />
      {errors.age && <span>{errors.age.message}</span>}
      
      <button>–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
    </form>
  );
}
```

---

### –ü—Ä–∏–º–µ—Ä 3: –° –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–µ–π Storage

```tsx
import { useForm } from 'react-hook-form';
import browser from 'webextension-polyfill';

export function StorageForm() {
  const [settings, setSettings] = useState(null);
  const { register, handleSubmit, reset } = useForm();

  // –ó–∞–≥—Ä—É–∑–∏—Ç—å –ø—Ä–∏ –º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏
  useEffect(() => {
    browser.storage.sync.get('settings').then(data => {
      setSettings(data.settings || {});
      reset(data.settings);
    });
  }, [reset]);

  const onSubmit = async (data) => {
    await browser.storage.sync.set({ settings: data });
    alert('–°–æ—Ö—Ä–∞–Ω–µ–Ω–æ!');
  };

  if (!settings) return <div>–ó–∞–≥—Ä—É–∑–∫–∞...</div>;

  return (
    <form onSubmit={handleSubmit(onSubmit)}>
      <input {...register('name')} />
      <button>–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
    </form>
  );
}
```

---

## –†–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω—ë–Ω–Ω—ã–µ –ø–∞—Ç—Ç–µ—Ä–Ω—ã

<details>
<summary><b>–ü–∞—Ç—Ç–µ—Ä–Ω 1: –°–±—Ä–æ—Å —Ñ–æ—Ä–º—ã</b></summary>

```tsx
const { register, handleSubmit, reset } = useForm();

// –°–±—Ä–æ—Å –∫ –∑–Ω–∞—á–µ–Ω–∏—è–º –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
const handleReset = () => {
  reset({
    enabled: true,
    theme: 'light'
  });
};

// –°–±—Ä–æ—Å –∫ –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã–º –¥–∞–Ω–Ω—ã–º
useEffect(() => {
  loadSettings().then(data => {
    reset(data); // –ó–∞–ø–æ–ª–Ω–∏—Ç—å —Ñ–æ—Ä–º—É –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏
  });
}, [reset]);
```

**–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:**
- –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–æ—Ä–º—É —Å–≤–µ–∂–∏–º–∏ –¥–∞–Ω–Ω—ã–º–∏
- –°–±—Ä–æ—Å–∏—Ç—å –∫ –∑–Ω–∞—á–µ–Ω–∏—è–º –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
- –û—Ç–º–µ–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è

</details>

<details>
<summary><b>–ü–∞—Ç—Ç–µ—Ä–Ω 2: –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –∑–Ω–∞—á–µ–Ω–∏–π –ø–æ–ª–µ–π</b></summary>

```tsx
const { register, watch } = useForm();

// –û—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å –æ–¥–Ω–æ –ø–æ–ª–µ
const enabled = watch('enabled');

// –û—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –ø–æ–ª–µ–π
const [enabled, theme] = watch(['enabled', 'theme']);

// –û—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å –≤—Å–µ –ø–æ–ª—è
const formData = watch();

return (
  <div>
    <input type="checkbox" {...register('enabled')} />
    {enabled && <p>–†–∞—Å—à–∏—Ä–µ–Ω–∏–µ –≤–∫–ª—é—á–µ–Ω–æ!</p>}
  </div>
);
```

**–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:**
- –ü–æ–∫–∞–∑—ã–≤–∞—Ç—å/—Å–∫—Ä—ã–≤–∞—Ç—å –ø–æ–ª—è –Ω–∞ –æ—Å–Ω–æ–≤–µ –¥—Ä—É–≥–∏—Ö –ø–æ–ª–µ–π
- –í–∞–ª–∏–¥–∞—Ü–∏—è –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
- –ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä –∏–∑–º–µ–Ω–µ–Ω–∏–π

</details>

<details>
<summary><b>–ü–∞—Ç—Ç–µ—Ä–Ω 3: –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è</b></summary>

```tsx
<input
  {...register('username', {
    validate: {
      checkAvailable: async (value) => {
        const response = await fetch(`/api/check/${value}`);
        const available = await response.json();
        return available || '–ò–º—è –∑–∞–Ω—è—Ç–æ';
      }
    }
  })}
/>
```

**–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:**
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ –∏–º–µ–Ω–∏/email
- –ü—Ä–æ–≤–µ—Ä–∫–∞ API –∫–ª—é—á–µ–π
- –í–∞–ª–∏–¥–∞—Ü–∏—è –¥–æ–º–µ–Ω–æ–≤

</details>

---

## –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

<details>
<summary><b>–°–≤—è–∑–∞–Ω–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã</b></summary>

- üìö [react-hook-form –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è](https://react-hook-form.com/)
- üìö [Browser Storage API](https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/storage)
- üéì [Chrome Extension Popup](https://developer.chrome.com/docs/extensions/mv3/user_interface/#popup)
- üí° [–ü–∞—Ç—Ç–µ—Ä–Ω—ã –≤–∞–ª–∏–¥–∞—Ü–∏–∏ —Ñ–æ—Ä–º](https://react-hook-form.com/advanced-usage#FormProviderPerformance)
- üéì [webextension-polyfill](https://github.com/mozilla/webextension-polyfill)

</details>

---

## –ó–∞–¥–∞–Ω–∏–µ

**–ü–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–∞–º–∏:**

1. **–î–æ–±–∞–≤—å—Ç–µ —Å–µ–∫—Ü–∏—é –ø—Ä–æ–¥–≤–∏–Ω—É—Ç—ã—Ö –Ω–∞—Å—Ç—Ä–æ–µ–∫:**
   - –°–≤–æ—Ä–∞—á–∏–≤–∞–µ–º–∞—è —Å–µ–∫—Ü–∏—è "–ü—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–µ"
   - –°–ª–∞–π–¥–µ—Ä —Ä–∞–∑–º–µ—Ä–∞ —à—Ä–∏—Ñ—Ç–∞ (12-24px)
   - –í—ã–±–æ—Ä —Ü–≤–µ—Ç–∞ –¥–ª—è —Ñ–æ–Ω–∞ —Ä–µ–¥–∞–∫—Ç–æ—Ä–∞
   - –≠–∫—Å–ø–æ—Ä—Ç/–∏–º–ø–æ—Ä—Ç –Ω–∞—Å—Ç—Ä–æ–µ–∫ –≤ JSON

2. **–†–µ–∞–ª–∏–∑—É–π—Ç–µ –≤–∞–ª–∏–¥–∞—Ü–∏—é —Ñ–æ—Ä–º—ã:**
   - –ì–æ—Ä—è—á–∞—è –∫–ª–∞–≤–∏—à–∞ –Ω–µ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –∑–∞—Ä–µ–∑–µ—Ä–≤–∏—Ä–æ–≤–∞–Ω–Ω–æ–π
   - –ò—Å–∫–ª—é—á—ë–Ω–Ω—ã–µ –¥–æ–º–µ–Ω—ã –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –≤–∞–ª–∏–¥–Ω—ã–º–∏ —Ö–æ—Å—Ç–∞–º–∏
   - –ü–æ–∫–∞–∑—ã–≤–∞–π—Ç–µ –≤–∞–ª–∏–¥–∞—Ü–∏—é –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏ (–Ω–µ —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ)

3. **–î–æ–±–∞–≤—å—Ç–µ –ø—Ä–µ—Å–µ—Ç—ã –Ω–∞—Å—Ç—Ä–æ–µ–∫:**
   - "–ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π", "–ü–æ —É–º–æ–ª—á–∞–Ω–∏—é", "–ü—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–π" –ø—Ä–µ—Å–µ—Ç—ã
   - –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –ø—Ä–µ—Å–µ—Ç–∞ –æ–¥–Ω–∏–º –∫–ª–∏–∫–æ–º
   - –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–≥–æ –ø—Ä–µ—Å–µ—Ç–∞

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
```tsx
<select onChange={applyPreset}>
  <option>–ü–æ —É–º–æ–ª—á–∞–Ω–∏—é</option>
  <option>–ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π</option>
  <option>–ü—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–π</option>
</select>

<div className="advanced">
  <input type="range" min="12" max="24" {...register('fontSize')} />
  <input type="color" {...register('bgColor')} />
</div>

<button onClick={exportSettings}>–≠–∫—Å–ø–æ—Ä—Ç</button>
<input type="file" onChange={importSettings} />
```

**–ë–æ–Ω—É—Å:**
- –î–æ–±–∞–≤–∏—Ç—å –Ω–∞–≤–∏–≥–∞—Ü–∏—é —Å –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã –≤ popup (Tab, Enter)
- –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å —Ç—ë–º–Ω—É—é —Ç–µ–º—É –¥–ª—è popup
- –î–æ–±–∞–≤–∏—Ç—å –ø–æ–¥—Å–∫–∞–∑–∫–∏ —Å –æ–±—ä—è—Å–Ω–µ–Ω–∏–µ–º –∫–∞–∂–¥–æ–π –Ω–∞—Å—Ç—Ä–æ–π–∫–∏

---

**–°–ª–µ–¥—É—é—â–∏–π:** [–°–ª–∞–π–¥ 11: –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Ö—Ä–∞–Ω–∏–ª–∏—â–∞](./11-storage-api.md)